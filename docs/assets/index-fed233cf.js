var X=Object.defineProperty;var H=(n,t,e)=>t in n?X(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var s=(n,t,e)=>(H(n,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}})();const w=84,x=48,_=4;function y(n){return JSON.parse(JSON.stringify(n))}class I{constructor(){s(this,"_keys");this._keys=[]}keydownEventHandler(t){this._keys[t.keyCode]=!0}keyupEventHandler(t){this._keys[t.keyCode]=!1}bindEvents(){document.body.addEventListener("keydown",this.keydownEventHandler.bind(this)),document.body.addEventListener("keyup",this.keyupEventHandler.bind(this))}getState(){const t=new A;return t.setKeys(y(this._keys)),t}}class A{constructor(){s(this,"keys",[])}setKeys(t){this.keys=t}}const M=new I;class T{constructor(){s(this,"_x");s(this,"_y");s(this,"_buttons");this._x=0,this._y=0,this._buttons=[!1,!1,!1]}pressEventHandler(t){this._buttons[t.button]=!0}releaseEventHandler(t){this._buttons[t.button]=!1}moveEventHandler(t){t.target&&(this._x=t.offsetX/_,this._y=t.offsetY/_)}cancelEventHandler(){}getState(){const t=new Y;return t.x=y(this._x),t.y=y(this._y),t.buttons=y(this._buttons),t}bindEvent(t){t.addEventListener("mousedown",this.pressEventHandler.bind(this)),t.addEventListener("mousemove",this.moveEventHandler.bind(this)),t.addEventListener("mouseup",this.releaseEventHandler.bind(this)),t.addEventListener("mouseout",this.cancelEventHandler.bind(this))}}class Y{constructor(){s(this,"x",0);s(this,"y",0);s(this,"buttons",[!1,!1,!1])}}const R=new T;class L{constructor(t,e){s(this,"_context");s(this,"_secondsPassed",0);s(this,"_oldTimeStamp",0);s(this,"_fps",0);s(this,"_running",!1);s(this,"_update");s(this,"_test",0);t.style.width=Math.floor(w*_)+"px",t.style.height=Math.floor(x*_)+"px",t.style.imageRendering="pixelated",t.width=w,t.height=x,this._context=t.getContext("2d"),this._context.imageSmoothingEnabled=!1,this._context.translate(0,0),this._update=e,R.bindEvent(t),M.bindEvents()}loop(t=0){this._secondsPassed=t-this._oldTimeStamp,this._oldTimeStamp=t,this._update(this._context,this._secondsPassed),window.requestAnimationFrame(this.loop.bind(this))}run(){this._running||this.loop()}}const u=class{constructor(t,e,r,i=255){s(this,"_r");s(this,"_g");s(this,"_b");s(this,"_a");this._r=Math.floor(t),this._g=Math.floor(e),this._b=Math.floor(r),this._a=Math.floor(i)}get R(){return this._r}get G(){return this._g}get B(){return this._b}get A(){return this._a}ToHEXWithA(t){return u.RGBAtoHEX(this._r,this._g,this.B,t)}ToHEX(t=!1){return t?u.RGBAtoHEX(this._r,this._g,this.B,this.A):u.RGBtoHEX(this._r,this._g,this.B)}};let h=u;s(h,"FromHEX",(t,e=1)=>{const[r,i,o]=t.match(/\w\w/g).map(a=>parseInt(a,16));return new u(r,i,o,parseInt((e*255).toString()))}),s(h,"RGBtoHEX",(t,e,r)=>{let o=(t+","+e+","+r).match(/^[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);return o&&o.length===4?"#"+("0"+parseInt(o[1],10).toString(16)).slice(-2)+("0"+parseInt(o[2],10).toString(16)).slice(-2)+("0"+parseInt(o[3],10).toString(16)).slice(-2):""}),s(h,"RGBAtoHEX",(t,e,r,i)=>{let a=(t+","+e+","+r+","+i).match(/^[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);return a&&a.length===5?"#"+("0"+parseInt(a[1],10).toString(16)).slice(-2)+("0"+parseInt(a[2],10).toString(16)).slice(-2)+("0"+parseInt(a[3],10).toString(16)).slice(-2)+("0"+parseInt(a[4],10).toString(16)).slice(-2):""}),s(h,"NokiaColorOne",u.FromHEX("#c7f0d8")),s(h,"NokiaColorTwo",u.FromHEX("#43523d"));class G{constructor(){s(this,"_scenes",[])}pushScene(t){this._scenes.push(t)}popScene(){this._scenes.pop()}clear(){this._scenes=[]}update(t){this._scenes[this._scenes.length-1].update(t)}draw(t){for(let e=0;e<this._scenes.length;e++)this._scenes[e].draw(t)}}const v=new G;class d{constructor(t=0,e=0){s(this,"X");s(this,"Y");this.X=t,this.Y=e}static get Zero(){return new d}static get Left(){return new d(-1,0)}static get Right(){return new d(1,0)}static get Up(){return new d(0,-1)}static get Down(){return new d(0,1)}}function g(n,t){for(var e=n.x,r=n.y,i=!1,o=0,a=t.length-1;o<t.length;a=o++){var k=t[o].x,f=t[o].y,S=t[a].x,E=t[a].y,P=f>r!=E>r&&e<(S-k)*(r-f)/(E-f)+k;P&&(i=!i)}return i}class N{constructor(t=0,e=0){s(this,"X");s(this,"Y");this.X=t,this.Y=e}}const l=new N;class O{constructor(){s(this,"_position",d.Zero);s(this,"_rotation",17);s(this,"_rotationSpeed",.05);s(this,"_longeur",10);s(this,"_life",3)}update(t){this._rotation=this._rotation+this._rotationSpeed*t,this._rotation>360&&(this._rotation-=360),this._rotation<0&&(this._rotation+=360)}draw(t){let e=this._rotation*Math.PI/180,r=Math.cos(e),i=Math.sin(e);t.strokeStyle=h.NokiaColorTwo.ToHEX(),t.lineWidth=3,t.beginPath(),t.moveTo(this._position.X-r*this._longeur-l.X,this._position.Y-i*this._longeur-l.Y),t.lineTo(this._position.X+r*this._longeur-l.X,this._position.Y+i*this._longeur-l.Y),t.stroke(),t.closePath(),t.beginPath(),t.arc(this._position.X-l.X,this._position.Y-l.Y,1,0,2*Math.PI),t.stroke(),t.closePath(),t.beginPath(),t.fillRect(2,2,2,2),t.fillRect(6,2,2,2),t.fillRect(10,2,2,2),t.closePath()}getExternPoints(){let t=this._rotation*Math.PI/180,e=Math.cos(t),r=Math.sin(t);var i={x:this._position.X-e*this._longeur,y:this._position.Y-r*this._longeur},o={x:this._position.X+e*this._longeur,y:this._position.Y+r*this._longeur};return[i,o]}}const B=-1,C=30,K=!1,D=[{draworder:"topdown",id:2,name:"map",objects:[{class:"",height:0,id:3,name:"",polygon:[{x:18.1778521049953,y:31.9930197047917},{x:65.440267577983,y:47.9895295571875},{x:119.973823892969,y:56.7148985675853},{x:197.775030902349,y:48.7166436413873},{x:193.41234639715,y:86.5265760197775},{x:44.3539591361885,y:110.521340798371}],properties:[{name:"type",type:"string",value:"inner"}],rotation:0,visible:!0,width:0,x:0,y:0},{class:"",height:0,id:4,name:"",polygon:[{x:3.63557042099906,y:7.27114084199812},{x:49.4437577255872,y:15.9965098523958},{x:122.882280229768,y:34.9014760415909},{x:235.584963280739,y:30.5387915363921},{x:237.039191449138,y:61.8046971569839},{x:226.859594270341,y:108.339998545772},{x:13.8151675997964,y:142.514360503163}],properties:[{name:"type",type:"string",value:"outer"}],rotation:0,visible:!0,width:0,x:0,y:0},{class:"",height:0,id:5,name:"",point:!0,properties:[{name:"type",type:"string",value:"start"}],rotation:0,visible:!0,width:0,x:20.3591943575947,y:24.7218788627936}],opacity:1,type:"objectgroup",visible:!0,x:0,y:0}],F=3,W=7,q="orthogonal",J="right-down",Z="1.9.2",U=8,z=[],Q=8,$="map",V="1.9",j=53,m={compressionlevel:B,height:C,infinite:K,layers:D,nextlayerid:F,nextobjectid:W,orientation:q,renderorder:J,tiledversion:Z,tileheight:U,tilesets:z,tilewidth:Q,type:$,version:V,width:j};class tt{constructor(){s(this,"_levels");s(this,"_levelIndex",0);this._levels=[],this._levels.push(m)}load(t){console.log(m)}getStart(){for(var t of this._levels[this._levelIndex].layers[0].objects)if(t.properties[0].value=="start")return{x:t.x,y:t.y};return{x:0,y:0}}getInner(){for(var t of this._levels[this._levelIndex].layers[0].objects)if(t.polygon&&t.properties[0].value=="inner")return t.polygon;return[]}getOuter(){for(var t of this._levels[this._levelIndex].layers[0].objects)if(t.polygon&&t.properties[0].value=="outer")return t.polygon;return[]}draw(t){t.strokeStyle=h.NokiaColorTwo.ToHEX(),t.lineWidth=1,t.beginPath();for(var e of this._levels[this._levelIndex].layers[0].objects)if(e.polygon&&(e.properties[0].value=="inner"||e.properties[0].value=="outer")){for(let r=0;r<e.polygon.length;r++)r==0?t.moveTo(Math.floor(e.polygon[r].x)-l.X,Math.floor(e.polygon[r].y)-l.Y):t.lineTo(Math.floor(e.polygon[r].x)-l.X,Math.floor(e.polygon[r].y)-l.Y),t.stroke();t.lineTo(Math.floor(e.polygon[0].x)-l.X,Math.floor(e.polygon[0].y)-l.Y),t.stroke()}t.closePath()}}const p=new tt;class et{constructor(t,e,r,i,o){s(this,"x");s(this,"y");s(this,"lifetime");s(this,"vx");s(this,"vy");this.x=t,this.y=e,this.vx=r,this.vy=i,this.lifetime=o}update(t){this.lifetime--,this.x+=this.vx,this.y+=this.vy}get dead(){return this.lifetime<=0}draw(t){t.fillRect(Math.floor(this.x)-l.X,Math.floor(this.y)-l.Y,1,1)}}class st{constructor(){s(this,"_particles");this._particles=[]}update(t){for(let e=this._particles.length-1;e>-1;e--)try{this._particles[e].update(t),this._particles[e].dead&&this._particles.splice(e,1)}catch{console.log(e,this._particles.length)}}draw(t){this._particles.forEach(e=>{e.draw(t)})}add(t,e,r,i,o){let a=new et(t,e,r,i,o);this._particles.push(a)}createExplosion(t,e,r){for(let i=0;i<r;i++){let o=Math.random()*(2*Math.PI);this.add(t,e,Math.cos(o),Math.sin(o),100)}}}const c=new st;class it{constructor(){s(this,"speed",.02);s(this,"multiplier",1);s(this,"kuru");p.load("test"),this.kuru=new O,this.kuru._position=new d(p.getStart().x,p.getStart().y)}update(t){const e=M.getState();e.keys[16]?this.multiplier=2:this.multiplier=1,e.keys[68]&&(this.kuru._position.X+=t*this.speed*this.multiplier),e.keys[65]&&(this.kuru._position.X-=t*this.speed*this.multiplier),e.keys[87]&&(this.kuru._position.Y-=t*this.speed*this.multiplier),e.keys[83]&&(this.kuru._position.Y+=t*this.speed*this.multiplier),this.kuru.update(t),l.X=this.kuru._position.X-42,l.Y=this.kuru._position.Y-24,this.caTouche(),c.update(t)}caTouche(){var t=p.getInner();g(this.kuru.getExternPoints()[0],t)&&c.createExplosion(this.kuru.getExternPoints()[0].x,this.kuru.getExternPoints()[0].y,20),g(this.kuru.getExternPoints()[1],t)&&c.createExplosion(this.kuru.getExternPoints()[1].x,this.kuru.getExternPoints()[1].y,20);var e=p.getOuter();g(this.kuru.getExternPoints()[0],e)||c.createExplosion(this.kuru.getExternPoints()[0].x,this.kuru.getExternPoints()[0].y,20),g(this.kuru.getExternPoints()[1],e)||c.createExplosion(this.kuru.getExternPoints()[1].x,this.kuru.getExternPoints()[1].y,20)}draw(t){p.draw(t),this.kuru.draw(t),c.draw(t)}}class rt{constructor(){v.pushScene(new it)}update(t){v.update(t)}draw(t){this.clear(t),v.draw(t)}clear(t){const e=t.fillStyle;t.fillStyle=h.NokiaColorOne.ToHEX(),t.fillRect(0,0,w,x),t.fillStyle=e}}const b=new rt,ot=document.querySelector("#game"),nt=new L(ot,(n,t)=>{b.update(t),b.draw(n)});nt.run();
